/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package org.dynamics;

import org.dynamics.db.Db;
import org.dynamics.db.LevelDb;
import org.dynamics.model.Person;
import org.dynamics.reader.CsvFileReader;
import org.dynamics.reader.Reader;
import org.dynamics.ui.BouteFrame;
import org.dynamics.ui.CommonFrame;
import org.dynamics.ui.EventListFrame;
import org.dynamics.ui.FindFrame;

import javax.swing.*;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.io.IOException;
import java.nio.file.Paths;
import java.time.LocalDateTime;
import java.util.LinkedHashMap;
import java.util.List;
import java.util.Map;

public class Library  extends CommonFrame {
    private Map<String, Map<String, ActionListener>> men = new LinkedHashMap<>();
    private Map<String, ActionListener> fileMenuItems = new LinkedHashMap<>();
    private Map<String, ActionListener> bouteMenuItems = new LinkedHashMap<>();
    private Map<String, ActionListener> searchMenuItems = new LinkedHashMap<>();
    private Db db = new LevelDb();
    public Library(String title) throws UnsupportedLookAndFeelException, ClassNotFoundException, InstantiationException, IllegalAccessException, IOException {
        super(title);
        this.commonNorthPanel();
        searchMenuItems.put("Find Players",(ActionEvent e)->{
            try {
                JComboBox<String> comboBox = comboBox(db.keyFilterBy("File_"));
                confirmation("Please select imported file.",()->comboBox);
                String keySelected = comboBox.getSelectedItem().toString().trim();

                if(!keySelected.isEmpty()){
                    List<Person> persons = db.find(keySelected);
                    FindFrame findFrame = new FindFrame("Find",persons);
                    findFrame.northpanel();
                    findFrame.addDetails(db);
                    findFrame.southPanel();
                }else {
                    alert("Please select valid file Id");
                }
            } catch (Exception ex) {
                ex.printStackTrace();
                alert(ex.getMessage());
            }
        });
        bouteMenuItems.put("Find Events",(ActionEvent e)->{
            try {
                BouteFrame bouteFrame = new BouteFrame("Find Events",db);
                bouteFrame.northPanel();
                bouteFrame.centerPanel();
                bouteFrame.southPanel();
            } catch (Exception ex) {
                ex.printStackTrace();
                alert(ex.getMessage());
            }

        });
        bouteMenuItems.put("List Events", (ActionEvent e)->{
            try {
                EventListFrame eventListFrame = new EventListFrame("List Events");
                eventListFrame.listEvents(db);
            } catch (Exception ex) {
                ex.printStackTrace();
                alert(ex.getMessage());
            }
        });
        fileMenuItems.put("Import",(ActionEvent e)->{
            try {
                fileChooser().ifPresent(filePath->{
                    Reader<Person> reader = null;
                    try {
                        reader = new CsvFileReader(filePath);
                        List<Person> persons =  reader.read();
                        String key = Paths.get(filePath).getFileName().toString().concat("_"+LocalDateTime.now().toString());
                        db.insert("File_"+key,persons);
                        alert("Total : "+persons.size()+" Uploaded Successfully...!");
                    } catch (Exception ex) {
                        ex.printStackTrace();
                        alert(ex.getMessage());
                    }
                });

            } catch (Exception ex) {
                ex.printStackTrace();
                alert(ex.getMessage());
            }
        });
        men.put("File", fileMenuItems);
        men.put("Event", bouteMenuItems);
        men.put("Search", searchMenuItems);
        super.menuBar(men);
    }
    public static void main(String args[]) throws UnsupportedLookAndFeelException, ClassNotFoundException, InstantiationException, IllegalAccessException, IOException {
        Library library = new Library("Dynamcis 101 MMA");
    }
}
